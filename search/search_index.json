{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"zelig2","text":"<p>A modern R package for statistical model estimation, counterfactual simulation, and visualization --- building on the Zelig framework developed at Harvard's Institute for Quantitative Social Science (IQSS).</p>"},{"location":"#background","title":"Background","text":"<p>The original Zelig package (Imai, King, and Lau 2007, 2008) introduced a powerful idea: unify statistical model estimation behind a single interface --- <code>zelig() -&gt; setx() -&gt; sim() -&gt; plot()</code> --- so that researchers could move seamlessly from model fitting to substantively meaningful quantities of interest (expected values, predicted values, and first differences). Zelig operationalized the simulation-based approach to statistical interpretation described in King, Tomz, and Wittenberg (2000, AJPS).</p> <p><code>zelig2</code> is a ground-up reimplementation of Zelig that preserves its core workflow while modernizing the internals. The estimation--simulation--visualization pipeline remains the same; <code>zelig2</code> updates the package architecture, plotting system, and feature set for contemporary applied research.</p>"},{"location":"#the-zelig2-workflow","title":"The zelig2 Workflow","text":"<p>Every analysis in <code>zelig2</code> follows four steps:</p> <pre><code>library(zelig2)\n\nz &lt;- zelig2(y ~ x1 + x2, model = \"ls\", data = mydata)   # 1. Estimate\nz &lt;- setx(z, x1 = 10)                                     # 2. Set scenario\nz &lt;- sim(z)                                                # 3. Simulate\nplot(z)                                                    # 4. Visualize\n</code></pre> <ol> <li>Estimate a model with <code>zelig2()</code>.</li> <li>Set counterfactual covariate values with <code>setx()</code> (and optionally <code>setx1()</code> for contrasts).</li> <li>Simulate quantities of interest --- expected values, predicted values, and first differences --- with <code>sim()</code>.</li> <li>Visualize the results with <code>plot()</code>.</li> </ol>"},{"location":"#why-zelig2","title":"Why zelig2?","text":"<p>Zelig (Imai, King, and Lau) was last updated in 2020 and relies on <code>setRefClass</code>, base R graphics, and 16 dependencies. <code>zelig2</code> retains Zelig's workflow while addressing these limitations:</p> Feature Zelig (Imai, King, and Lau) zelig2 Survey weights Separate model types (<code>logit.survey</code>) Seamless <code>weights =</code> argument Fixed effects Not supported Built-in via <code>fixest</code> Robust SEs Not supported HC0--HC4, cluster, bootstrap Plotting Base R ggplot2 + patchwork Dependencies 16 7 OOP style setRefClass (mutable) S3 (functional, immutable) Last updated 2020 Active"},{"location":"#supported-models","title":"Supported Models","text":"Model <code>model =</code> Category Least Squares (OLS) <code>\"ls\"</code> Continuous Logistic Regression <code>\"logit\"</code> Binary Probit Regression <code>\"probit\"</code> Binary Poisson Regression <code>\"poisson\"</code> Count Negative Binomial <code>\"negbin\"</code> Count Gamma Regression <code>\"gamma\"</code> Continuous Tobit (Censored) <code>\"tobit\"</code> Continuous Quantile Regression <code>\"quantile\"</code> Continuous <p>All models except tobit and quantile support fixed effects via <code>fixest</code>.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<p>Using data from the U.S. Census Bureau's Household Pulse Survey, we estimate the relationship between household income and food insecurity:</p> <pre><code>library(zelig2)\n\nz &lt;- zelig2(food_insecure ~ age + college + income_k,\n            model = \"logit\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 35, college = 0, income_k = 50)\nz &lt;- setx1(z, age = 35, college = 0, income_k = 100)\nz &lt;- sim(z)\n\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 0.2028  SD: 0.0038  [0.1955, 0.2104]\nFirst Differences:\n  Mean: -0.1204  SD: 0.0026  [-0.1254, -0.1154]\n</code></pre> <p>Moving from $50k to $100k in household income reduces the predicted probability of food insecurity by approximately 12 percentage points (95% CI: [-0.125, -0.115]).</p>"},{"location":"#installation","title":"Installation","text":"<pre><code># Install from GitHub\ndevtools::install_github(\"tlcaputi/zelig2\", subdir = \"r\")\n</code></pre>"},{"location":"#acknowledgments","title":"Acknowledgments","text":"<p><code>zelig2</code> builds directly on the intellectual foundation of the Zelig project at Harvard's Institute for Quantitative Social Science (IQSS). The core idea --- estimate a model, set counterfactual scenarios, simulate quantities of interest, and visualize --- originates with:</p> <ul> <li>King, G., Tomz, M., and Wittenberg, J. (2000). \"Making the Most of Statistical Analyses: Improving Interpretation and Presentation.\" American Journal of Political Science, 44(2), 347--361.</li> <li>Imai, K., King, G., and Lau, O. (2007). \"Zelig: Everyone's Statistical Software.\" https://github.com/IQSS/Zelig</li> <li>Imai, K., King, G., and Lau, O. (2008). \"Toward a Common Framework for Statistical Analysis and Development.\" Journal of Computational and Graphical Statistics, 17(4), 892--913.</li> </ul> <p>The Zelig package was subsequently maintained by Choirat, Honaker, Imai, King, and Lau. <code>zelig2</code> would not exist without their foundational work.</p>"},{"location":"getting-started/","title":"Getting Started","text":"<p><code>zelig2</code> follows the same four-step workflow introduced by the original Zelig package (Imai, King, and Lau 2007, 2008): estimate, set scenarios, simulate, and visualize. If you have used Zelig before, the interface will be familiar.</p>"},{"location":"getting-started/#installation","title":"Installation","text":"<p>Install <code>zelig2</code> from GitHub:</p> <pre><code>devtools::install_github(\"tlcaputi/zelig2\", subdir = \"r\")\n</code></pre>"},{"location":"getting-started/#dependencies","title":"Dependencies","text":"<p><code>zelig2</code> requires the following packages (installed automatically):</p> Package Purpose <code>ggplot2</code> Visualization <code>MASS</code> Parameter simulation (mvrnorm), negative binomial models <code>sandwich</code> Robust and clustered standard errors <code>survey</code> Survey-weighted estimation <code>patchwork</code> Composing multi-panel plots <code>AER</code> Tobit models <code>quantreg</code> Quantile regression <code>fixest</code> Fixed effects models"},{"location":"getting-started/#core-workflow","title":"Core Workflow","text":""},{"location":"getting-started/#step-1-estimate-a-model","title":"Step 1: Estimate a Model","text":"<pre><code>library(zelig2)\ndata(mtcars)\n\nz &lt;- zelig2(mpg ~ hp + wt, model = \"ls\", data = mtcars)\n</code></pre> <p><code>zelig2()</code> accepts a formula, a model name, and a data frame --- mirroring the original <code>zelig()</code> interface from King, Tomz, and Wittenberg (2000). It returns a <code>zelig2</code> object containing the fitted model and all metadata needed for simulation.</p>"},{"location":"getting-started/#step-2-set-a-counterfactual-scenario","title":"Step 2: Set a Counterfactual Scenario","text":"<pre><code>z &lt;- setx(z, hp = 150, wt = 3)\n</code></pre> <p><code>setx()</code> specifies the covariate values at which to compute quantities of interest. Variables not explicitly set default to their sample median (numeric) or mode (factor).</p>"},{"location":"getting-started/#step-3-simulate-quantities-of-interest","title":"Step 3: Simulate Quantities of Interest","text":"<pre><code>z &lt;- sim(z)\n</code></pre> <p><code>sim()</code> implements the simulation-based approach to inference from King, Tomz, and Wittenberg (2000). It draws parameter vectors from \\(\\mathcal{N}(\\hat{\\beta}, \\hat{V})\\) and computes:</p> <ul> <li>Expected values (EV): \\(E[Y \\mid X]\\), the systematic component.</li> <li>Predicted values (PV): Draws from the stochastic component, incorporating observation-level noise.</li> </ul>"},{"location":"getting-started/#step-4-examine-results","title":"Step 4: Examine Results","text":"<pre><code>summary(z)\nplot(z)\n</code></pre>"},{"location":"getting-started/#first-differences","title":"First Differences","text":"<p>To estimate the causal effect of changing one covariate, set a baseline scenario with <code>setx()</code> and a contrast scenario with <code>setx1()</code>:</p> <pre><code>z &lt;- zelig2(mpg ~ hp + wt, model = \"ls\", data = mtcars)\nz &lt;- setx(z, hp = 100, wt = 3)\nz &lt;- setx1(z, hp = 200, wt = 3)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <p>The first difference is \\(\\text{EV}(\\texttt{setx1}) - \\text{EV}(\\texttt{setx})\\).</p>"},{"location":"getting-started/#range-scenarios","title":"Range Scenarios","text":"<p>Pass a vector of values to one covariate to see how predictions change across its range:</p> <pre><code>z &lt;- zelig2(mpg ~ hp + wt, model = \"ls\", data = mtcars)\nz &lt;- setx(z, hp = seq(50, 300, by = 50), wt = 3)\nz &lt;- sim(z)\nplot(z)\n</code></pre> <p>This produces a ribbon plot showing the expected value and its 95% confidence band across the range of <code>hp</code>.</p>"},{"location":"getting-started/#pipe-friendly","title":"Pipe-Friendly","text":"<p>All functions return <code>zelig2</code> objects, so the workflow chains naturally with R's pipe operator:</p> <pre><code>z &lt;- zelig2(mpg ~ hp + wt, model = \"ls\", data = mtcars) |&gt;\n  setx(hp = 150, wt = 3) |&gt;\n  sim()\n\nsummary(z)\nplot(z)\n</code></pre>"},{"location":"getting-started/#robust-standard-errors","title":"Robust Standard Errors","text":"<p>Specify <code>vcov_type</code> to use heteroskedasticity-consistent standard errors:</p> <pre><code>z &lt;- zelig2(mpg ~ hp + wt, model = \"ls\", data = mtcars,\n            vcov_type = \"HC1\")\n</code></pre> <p>Available options: <code>\"HC0\"</code>, <code>\"HC1\"</code> (alias <code>\"robust\"</code>), <code>\"HC2\"</code>, <code>\"HC3\"</code>, <code>\"HC4\"</code>, <code>\"cluster\"</code>, <code>\"bootstrap\"</code>.</p>"},{"location":"getting-started/#survey-weights","title":"Survey Weights","text":"<p>Pass a numeric weight vector to <code>weights</code>:</p> <pre><code>z &lt;- zelig2(y ~ x1 + x2, model = \"ls\", data = mydata,\n            weights = mydata$sampling_weight)\n</code></pre> <p>For full survey design specifications, use <code>survey_design</code>, or the convenience arguments <code>ids</code>, <code>strata</code>, and <code>fpc</code>.</p>"},{"location":"getting-started/#fixed-effects","title":"Fixed Effects","text":"<p>Use the pipe syntax in the formula or the <code>fixef</code> argument:</p> <pre><code># Pipe syntax\nz &lt;- zelig2(y ~ x1 + x2 | state + year, model = \"ls\", data = panel)\n\n# fixef argument\nz &lt;- zelig2(y ~ x1 + x2, model = \"ls\", data = panel,\n            fixef = ~ state + year)\n</code></pre> <p>Fixed effects are estimated via <code>fixest</code> and support cluster-robust standard errors.</p>"},{"location":"reference/api/","title":"API Reference","text":"<p>Complete reference for all user-facing functions in the <code>zelig2</code> package. The core workflow --- <code>zelig2() -&gt; setx() -&gt; sim() -&gt; plot()</code> --- mirrors the original Zelig interface (Imai, King, and Lau 2007, 2008), implementing the simulation-based approach to statistical interpretation from King, Tomz, and Wittenberg (2000, AJPS).</p>"},{"location":"reference/api/#core-functions","title":"Core Functions","text":""},{"location":"reference/api/#zelig2","title":"zelig2()","text":"<p>Main entry point for fitting statistical models with simulation-based inference.</p> <p>Signature: <pre><code>zelig2(formula, model, data, weights = NULL, survey_design = NULL,\n       ids = NULL, strata = NULL, fpc = NULL, nest = FALSE,\n       fixef = NULL, vcov_type = \"default\", cluster = NULL,\n       bootstrap_n = 500, num = 1000, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>formula</code> formula Model formula. For fixed effects, use <code>y ~ x1 + x2 \\| fe_var</code> syntax <code>model</code> character Model type: \"ls\", \"logit\", \"probit\", \"poisson\", \"negbin\", \"gamma\", \"tobit\", \"quantile\" <code>data</code> data.frame Input dataset. Character columns automatically converted to factors <code>weights</code> numeric vector, formula, or character Survey or frequency weights. Can be vector, one-sided formula (e.g., <code>~weight_var</code>), or column name string <code>survey_design</code> survey.design Pre-constructed survey design object from <code>survey</code> package <code>ids</code> formula or character PSU/cluster identifiers for survey design (e.g., <code>~psu</code>) <code>strata</code> formula or character Stratification variable for survey design (e.g., <code>~stratum</code>) <code>fpc</code> formula or character Finite population correction for survey design <code>nest</code> logical Whether PSUs are nested within strata (default FALSE) <code>fixef</code> formula or character vector Alternative fixed effects specification. One-sided formula (e.g., <code>~state</code>) or character vector of variable names <code>vcov_type</code> character Variance-covariance type: \"default\", \"robust\"/\"HC1\", \"HC0\", \"HC2\", \"HC3\", \"HC4\", \"cluster\", \"bootstrap\" <code>cluster</code> formula or character Cluster variable for cluster-robust standard errors <code>bootstrap_n</code> integer Number of bootstrap replicates when <code>vcov_type = \"bootstrap\"</code> (default 500) <code>num</code> integer Number of simulation draws for quantities of interest (default 1000) <code>...</code> additional arguments Model-specific parameters passed to underlying fitting function <p>Returns: A <code>zelig2</code> object containing the fitted model, model specifications, and methods for simulation and visualization.</p> <p>Examples:</p> <pre><code># Basic OLS\nz1 &lt;- zelig2(income ~ education + age, model = \"ls\", data = mydata)\n\n# Logit with robust standard errors\nz2 &lt;- zelig2(employed ~ education, model = \"logit\", data = mydata,\n             vcov_type = \"robust\")\n\n# Fixed effects model\nz3 &lt;- zelig2(outcome ~ treatment + controls | state,\n             model = \"ls\", data = panel_data)\n\n# Survey-weighted model\nz4 &lt;- zelig2(satisfaction ~ service_quality, model = \"ls\", data = survey_data,\n             weights = ~survey_weight, strata = ~region, ids = ~cluster_id)\n\n# Quantile regression at 75th percentile\nz5 &lt;- zelig2(wage ~ education + experience, model = \"quantile\",\n             data = mydata, tau = 0.75)\n</code></pre>"},{"location":"reference/api/#setx","title":"setx()","text":"<p>Set covariate values to define a scenario for simulation of quantities of interest.</p> <p>Signature: <pre><code>setx(object, ..., fn = NULL)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 Fitted zelig2 model object <code>...</code> named arguments Covariate values. One variable can be a vector to create range scenarios <code>fn</code> function or character Default function applied to unspecified numeric covariates (e.g., \"mean\", \"median\", or custom function) <p>Returns: A <code>setx</code> object containing the specified covariate scenario. Can be passed to <code>sim()</code>.</p> <p>Examples:</p> <pre><code># Set all covariates to their means\nx1 &lt;- setx(z, fn = mean)\n\n# Set specific values\nx2 &lt;- setx(z, education = 16, age = 30)\n\n# Range scenario: vary education while holding others at mean\nx3 &lt;- setx(z, education = 12:20, fn = mean)\n\n# Multiple factor levels\nx4 &lt;- setx(z, region = c(\"North\", \"South\", \"East\", \"West\"), fn = median)\n</code></pre> <p>Notes: - For factors, must specify valid factor levels - Unspecified covariates use <code>fn</code> if numeric, or mode if categorical - Only one variable should vary in a single <code>setx()</code> call for range plots</p>"},{"location":"reference/api/#setx1","title":"setx1()","text":"<p>Set a contrast scenario for computing first differences (treatment effects).</p> <p>Signature: <pre><code>setx1(object, ..., fn = NULL)\n</code></pre></p> <p>Parameters:</p> <p>Same as <code>setx()</code>. Used in conjunction with <code>setx()</code> to define counterfactual scenarios.</p> <p>Returns: A <code>setx1</code> object defining the contrast scenario.</p> <p>Examples:</p> <pre><code># First difference: treatment effect\nx_control &lt;- setx(z, treatment = 0, fn = mean)\nx_treat &lt;- setx1(z, treatment = 1)\n\n# Before/after comparison\nx_before &lt;- setx(z, policy = 0, year = 2010, fn = mean)\nx_after &lt;- setx1(z, policy = 1, year = 2015)\n</code></pre> <p>Usage: Call <code>sim()</code> with both <code>setx()</code> and <code>setx1()</code> objects to compute first differences.</p>"},{"location":"reference/api/#sim","title":"sim()","text":"<p>Simulate quantities of interest from a fitted model and specified covariate scenarios.</p> <p>Signature: <pre><code>sim(object, num = NULL, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 Fitted model with attached <code>setx()</code> and optionally <code>setx1()</code> scenarios <code>num</code> integer Number of simulation draws. Overrides default from <code>zelig2()</code> call <code>...</code> additional arguments Additional parameters for simulation <p>Returns: A <code>sim</code> object containing simulated quantities: - <code>ev</code>: Expected values (predictions) - <code>pv</code>: Predicted values (with fundamental uncertainty) - <code>fd</code>: First differences (if <code>setx1()</code> was specified)</p> <p>Examples:</p> <pre><code># Basic prediction\nz &lt;- zelig2(income ~ education, model = \"ls\", data = mydata)\nz &lt;- setx(z, education = 16)\ns &lt;- sim(z)\n\n# First differences\nz &lt;- zelig2(employed ~ training, model = \"logit\", data = mydata)\nz &lt;- setx(z, training = 0, fn = mean)\nz &lt;- setx1(z, training = 1)\ns &lt;- sim(z)\n\n# Override number of simulations\ns &lt;- sim(z, num = 5000)\n</code></pre>"},{"location":"reference/api/#plot","title":"plot()","text":"<p>Visualize simulation results. Automatically selects appropriate plot type based on scenario.</p> <p>Signature: <pre><code>plot(x, ..., ci = 0.95)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>x</code> sim object Simulation results from <code>sim()</code> <code>...</code> additional arguments Graphical parameters <code>ci</code> numeric Confidence interval level (default 0.95 for 95% CI) <p>Returns: A ggplot object.</p> <p>Plot types: - Single scenario: density plot of expected values - Range scenario: line plot with confidence bands - First differences: density plot of treatment effect</p> <p>Examples:</p> <pre><code># Density plot for single scenario\nplot(s)\n\n# Range plot with 90% CI\nplot(s, ci = 0.90)\n\n# Customize with ggplot2\nplot(s) + labs(title = \"Treatment Effect Distribution\") + theme_minimal()\n</code></pre>"},{"location":"reference/api/#summary","title":"summary()","text":"<p>Print model summary including coefficient table and simulation results.</p> <p>Signature: <pre><code>summary(object, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 or sim object Fitted model or simulation results <code>...</code> additional arguments Passed to underlying summary methods <p>Returns: Prints formatted summary to console. For sim objects, includes quantiles of simulated quantities.</p> <p>Examples:</p> <pre><code># Model summary\nsummary(z)\n\n# Simulation summary\nsummary(s)\n</code></pre>"},{"location":"reference/api/#coef","title":"coef()","text":"<p>Extract model coefficients.</p> <p>Signature: <pre><code>coef(object, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 Fitted model object <code>...</code> additional arguments Passed to underlying coef methods <p>Returns: Named numeric vector of coefficients.</p> <p>Examples:</p> <pre><code>beta &lt;- coef(z)\nbeta[\"education\"]\n</code></pre>"},{"location":"reference/api/#vcov","title":"vcov()","text":"<p>Extract variance-covariance matrix of coefficients.</p> <p>Signature: <pre><code>vcov(object, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 Fitted model object <code>...</code> additional arguments Passed to underlying vcov methods <p>Returns: Variance-covariance matrix reflecting the specified <code>vcov_type</code>.</p> <p>Examples:</p> <pre><code># Standard vcov\nV &lt;- vcov(z)\n\n# For robust SEs, vcov reflects HC1 adjustment\nz_robust &lt;- zelig2(y ~ x, model = \"ls\", data = mydata, vcov_type = \"robust\")\nV_robust &lt;- vcov(z_robust)\n</code></pre>"},{"location":"reference/api/#utility-functions","title":"Utility Functions","text":""},{"location":"reference/api/#from_zelig2_model","title":"from_zelig2_model()","text":"<p>Extract the underlying fitted model object from a zelig2 wrapper.</p> <p>Signature: <pre><code>from_zelig2_model(object)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>object</code> zelig2 Fitted zelig2 model object <p>Returns: The original fitted model object (e.g., <code>lm</code>, <code>glm</code>, <code>fixest::feols</code>, etc.).</p> <p>Examples:</p> <pre><code>z &lt;- zelig2(y ~ x, model = \"ls\", data = mydata)\nlm_fit &lt;- from_zelig2_model(z)\n\n# Use with stargazer or other tools\nstargazer::stargazer(lm_fit)\n</code></pre>"},{"location":"reference/api/#to_zelig2","title":"to_zelig2()","text":"<p>Wrap an existing fitted model in a zelig2 object for use with <code>setx()</code> and <code>sim()</code>.</p> <p>Signature: <pre><code>to_zelig2(fit, model_name, ...)\n</code></pre></p> <p>Parameters:</p> Parameter Type Description <code>fit</code> model object Fitted model (lm, glm, etc.) <code>model_name</code> character Corresponding zelig2 model name (\"ls\", \"logit\", etc.) <code>...</code> additional arguments Additional metadata or parameters <p>Returns: A <code>zelig2</code> object wrapping the fitted model.</p> <p>Examples:</p> <pre><code># Fit model manually\nfit &lt;- lm(income ~ education + age, data = mydata)\n\n# Convert to zelig2 for simulation\nz &lt;- to_zelig2(fit, model_name = \"ls\")\nz &lt;- setx(z, education = 16, age = 30)\ns &lt;- sim(z)\n</code></pre> <p>Note: Useful for integrating zelig2 simulation workflow with existing model fitting code.</p>"},{"location":"reference/api/#list_models","title":"list_models()","text":"<p>List all registered model names and descriptions.</p> <p>Signature: <pre><code>list_models()\n</code></pre></p> <p>Parameters: None</p> <p>Returns: Data frame with columns: - <code>model</code>: Model name string - <code>description</code>: Short description of the model - <code>family</code>: Statistical family - <code>supports_fixef</code>: Whether fixed effects are supported - <code>supports_survey</code>: Whether survey weights are supported</p> <p>Examples:</p> <pre><code>list_models()\n\n# Filter for models supporting fixed effects\nmodels &lt;- list_models()\nmodels[models$supports_fixef, ]\n</code></pre>"},{"location":"reference/api/#object-classes","title":"Object Classes","text":""},{"location":"reference/api/#zelig2-object","title":"zelig2 object","text":"<p>Returned by <code>zelig2()</code>. Contains: - <code>fit</code>: Underlying fitted model - <code>model</code>: Model name - <code>formula</code>: Model formula - <code>data</code>: Original data (subset to complete cases) - <code>vcov_type</code>: Variance-covariance type - <code>num</code>: Number of simulation draws - Additional metadata for survey design, fixed effects, etc.</p> <p>Methods: <code>summary()</code>, <code>coef()</code>, <code>vcov()</code>, <code>print()</code></p>"},{"location":"reference/api/#setx-object","title":"setx object","text":"<p>Returned by <code>setx()</code>. Contains covariate scenario specifications.</p> <p>Methods: <code>print()</code></p>"},{"location":"reference/api/#sim-object","title":"sim object","text":"<p>Returned by <code>sim()</code>. Contains simulated quantities of interest.</p> <p>Slots: - <code>ev</code>: Expected values - <code>pv</code>: Predicted values - <code>fd</code>: First differences (if contrast scenario specified) - <code>qi</code>: Quantile information</p> <p>Methods: <code>summary()</code>, <code>plot()</code>, <code>print()</code></p>"},{"location":"reference/api/#advanced-usage","title":"Advanced Usage","text":""},{"location":"reference/api/#custom-variance-covariance-specifications","title":"Custom Variance-Covariance Specifications","text":"<pre><code># Cluster-robust SEs\nz &lt;- zelig2(y ~ x, model = \"ls\", data = mydata,\n            vcov_type = \"cluster\", cluster = ~state)\n\n# Bootstrap SEs with 1000 replicates\nz &lt;- zelig2(y ~ x, model = \"logit\", data = mydata,\n            vcov_type = \"bootstrap\", bootstrap_n = 1000)\n\n# HC3 heteroskedasticity-robust\nz &lt;- zelig2(y ~ x, model = \"ls\", data = mydata, vcov_type = \"HC3\")\n</code></pre>"},{"location":"reference/api/#complex-survey-designs","title":"Complex Survey Designs","text":"<pre><code># Two-stage cluster sample\nz &lt;- zelig2(outcome ~ predictor, model = \"ls\", data = survey_data,\n            ids = ~cluster_id, strata = ~stratum,\n            weights = ~sampling_weight, nest = TRUE)\n\n# Using pre-built survey design\nlibrary(survey)\ndes &lt;- svydesign(ids = ~psu, strata = ~region, weights = ~wt,\n                 data = mydata, nest = TRUE)\nz &lt;- zelig2(outcome ~ predictor, model = \"ls\", survey_design = des)\n</code></pre>"},{"location":"reference/api/#fixed-effects-models","title":"Fixed Effects Models","text":"<pre><code># Two-way fixed effects using formula syntax\nz &lt;- zelig2(outcome ~ treatment + controls | firm + year,\n            model = \"ls\", data = panel_data)\n\n# Alternative: fixef parameter\nz &lt;- zelig2(outcome ~ treatment + controls, model = \"ls\",\n            data = panel_data, fixef = ~firm + year)\n</code></pre>"},{"location":"reference/api/#multiple-scenarios","title":"Multiple Scenarios","text":"<pre><code># Compare multiple treatment levels\nz &lt;- zelig2(outcome ~ treatment, model = \"ls\", data = mydata)\n\n# Scenario 1: Control\nz &lt;- setx(z, treatment = 0)\ns1 &lt;- sim(z)\n\n# Scenario 2: Low treatment\nz &lt;- setx(z, treatment = 1)\ns2 &lt;- sim(z)\n\n# Scenario 3: High treatment\nz &lt;- setx(z, treatment = 2)\ns3 &lt;- sim(z)\n</code></pre>"},{"location":"reference/api/#see-also","title":"See Also","text":"<ul> <li>Supported Models for detailed model descriptions</li> <li>Package vignettes for workflow tutorials</li> <li><code>?zelig2</code> for R help documentation</li> </ul>"},{"location":"reference/api/#references","title":"References","text":"<ul> <li>King, G., Tomz, M., and Wittenberg, J. (2000). \"Making the Most of Statistical Analyses: Improving Interpretation and Presentation.\" American Journal of Political Science, 44(2), 347--361.</li> <li>Imai, K., King, G., and Lau, O. (2007). \"Zelig: Everyone's Statistical Software.\" https://github.com/IQSS/Zelig</li> <li>Imai, K., King, G., and Lau, O. (2008). \"Toward a Common Framework for Statistical Analysis and Development.\" Journal of Computational and Graphical Statistics, 17(4), 892--913.</li> </ul>"},{"location":"reference/models/","title":"Supported Models","text":"<p>The <code>zelig2</code> package supports 8 statistical models. The original Zelig package (Imai, King, and Lau 2007, 2008) supported many of the same model families; <code>zelig2</code> retains the core set while adding fixed effects (via <code>fixest</code>, Berg\u00e9 2018), robust/clustered/bootstrap standard errors (via <code>sandwich</code>, Zeileis 2004), and seamless survey weight integration (via <code>survey</code>, Lumley 2004). All models support standard errors via robust, cluster, or bootstrap methods.</p>"},{"location":"reference/models/#model-summary","title":"Model Summary","text":"Model String Family Link Outcome Type Fixed Effects Survey Weights Least Squares <code>ls</code> gaussian identity Continuous Yes Yes Logistic Regression <code>logit</code> binomial logit Binary (0/1) Yes Yes Probit Regression <code>probit</code> binomial probit Binary (0/1) Yes Yes Poisson Regression <code>poisson</code> poisson log Count Yes Yes (quasipoisson) Negative Binomial <code>negbin</code> custom log Overdispersed count Yes Yes (quasipoisson approx) Gamma Regression <code>gamma</code> Gamma inverse Positive continuous Yes Yes Tobit <code>tobit</code> custom identity Left-censored at 0 No No Quantile Regression <code>quantile</code> custom identity Conditional quantiles No No"},{"location":"reference/models/#detailed-model-descriptions","title":"Detailed Model Descriptions","text":""},{"location":"reference/models/#least-squares-ols","title":"Least Squares (OLS)","text":"<p>Model string: <code>\"ls\"</code></p> <p>Statistical specification: Gaussian family with identity link function</p> <p>Use case: Linear regression for continuous, unbounded outcome variables.</p> <p>Example formula: <pre><code>zelig2(income ~ education + age, model = \"ls\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported via <code>|</code> syntax or <code>fixef</code> parameter</p> <p>Survey weights: Supported via <code>weights</code> or full survey design specification</p>"},{"location":"reference/models/#logistic-regression","title":"Logistic Regression","text":"<p>Model string: <code>\"logit\"</code></p> <p>Statistical specification: Binomial family with logit link function</p> <p>Use case: Binary outcomes coded as 0/1. Estimates log-odds ratios.</p> <p>Example formula: <pre><code>zelig2(employed ~ education + age, model = \"logit\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported. Uses conditional fixed effects logit for panel data.</p> <p>Survey weights: Supported via survey design or weights parameter</p> <p>Note: Outcome must be binary (0/1). Use <code>factor()</code> for labeled categories if needed.</p>"},{"location":"reference/models/#probit-regression","title":"Probit Regression","text":"<p>Model string: <code>\"probit\"</code></p> <p>Statistical specification: Binomial family with probit (inverse normal) link function</p> <p>Use case: Binary outcomes coded as 0/1. Assumes normally distributed latent variable.</p> <p>Example formula: <pre><code>zelig2(voted ~ income + education, model = \"probit\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported via within-transformation</p> <p>Survey weights: Supported via survey design or weights parameter</p> <p>Note: Similar to logit but uses normal CDF instead of logistic. Coefficients not directly comparable to logit.</p>"},{"location":"reference/models/#poisson-regression","title":"Poisson Regression","text":"<p>Model string: <code>\"poisson\"</code></p> <p>Statistical specification: Poisson family with log link function</p> <p>Use case: Count outcomes (non-negative integers). Assumes mean equals variance.</p> <p>Example formula: <pre><code>zelig2(num_arrests ~ age + income, model = \"poisson\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported via conditional maximum likelihood</p> <p>Survey weights: Supported. Uses quasipoisson for survey designs to handle design effects.</p> <p>Note: If outcome shows overdispersion (variance &gt; mean), consider negative binomial model.</p>"},{"location":"reference/models/#negative-binomial","title":"Negative Binomial","text":"<p>Model string: <code>\"negbin\"</code></p> <p>Statistical specification: Negative binomial distribution with log link</p> <p>Use case: Overdispersed count data where variance exceeds the mean. More flexible than Poisson.</p> <p>Example formula: <pre><code>zelig2(hospital_visits ~ age + chronic_illness, model = \"negbin\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported via within-transformation</p> <p>Survey weights: Supported. Uses quasipoisson approximation for survey designs.</p> <p>Note: Includes dispersion parameter to model extra-Poisson variation.</p>"},{"location":"reference/models/#gamma-regression","title":"Gamma Regression","text":"<p>Model string: <code>\"gamma\"</code></p> <p>Statistical specification: Gamma family with inverse link function</p> <p>Use case: Positive continuous outcomes, often right-skewed (e.g., spending, duration, income).</p> <p>Example formula: <pre><code>zelig2(medical_spending ~ insurance + age, model = \"gamma\", data = mydata)\n</code></pre></p> <p>Fixed effects: Supported via within-transformation</p> <p>Survey weights: Supported via survey design or weights parameter</p> <p>Note: Outcome must be strictly positive (&gt; 0). Appropriate for skewed positive data.</p>"},{"location":"reference/models/#tobit-censored-regression","title":"Tobit (Censored Regression)","text":"<p>Model string: <code>\"tobit\"</code></p> <p>Statistical specification: Normal distribution with left-censoring at 0</p> <p>Use case: Continuous outcomes with a substantial proportion censored at zero (e.g., expenditures, time allocation).</p> <p>Example formula: <pre><code>zelig2(charity_donation ~ income + education, model = \"tobit\", data = mydata)\n</code></pre></p> <p>Fixed effects: NOT supported. Tobit models do not support fixed effects estimation.</p> <p>Survey weights: NOT supported in current implementation</p> <p>Implementation: Uses <code>AER::tobit()</code> for maximum likelihood estimation.</p> <p>Note: Assumes latent variable is normally distributed. Zeros should represent true censoring, not structural zeros.</p>"},{"location":"reference/models/#quantile-regression","title":"Quantile Regression","text":"<p>Model string: <code>\"quantile\"</code></p> <p>Statistical specification: Conditional quantile estimation via linear programming</p> <p>Use case: Estimating effects at different points of the outcome distribution, not just the mean. Robust to outliers.</p> <p>Example formula: <pre><code>zelig2(income ~ education + age, model = \"quantile\", data = mydata)\n</code></pre></p> <p>Parameters: Specify <code>tau</code> for desired quantile (default 0.5 for median): <pre><code>zelig2(income ~ education, model = \"quantile\", data = mydata, tau = 0.75)\n</code></pre></p> <p>Fixed effects: NOT supported. Quantile regression with fixed effects requires specialized methods.</p> <p>Survey weights: NOT supported in current implementation</p> <p>Implementation: Uses <code>quantreg::rq()</code> for estimation.</p> <p>Note: Standard errors via bootstrap recommended. Useful when mean effects may be misleading due to heterogeneous treatment effects.</p>"},{"location":"reference/models/#choosing-the-right-model","title":"Choosing the Right Model","text":"<p>Continuous outcomes: - Unbounded, approximately normal: <code>ls</code> - Positive, right-skewed: <code>gamma</code> - Censored at zero: <code>tobit</code> - Quantile effects: <code>quantile</code></p> <p>Binary outcomes (0/1): - General use: <code>logit</code> - Latent variable interpretation: <code>probit</code></p> <p>Count outcomes: - No overdispersion: <code>poisson</code> - Overdispersion present: <code>negbin</code></p> <p>Need fixed effects? - Supported: <code>ls</code>, <code>logit</code>, <code>probit</code>, <code>poisson</code>, <code>negbin</code>, <code>gamma</code> - Not supported: <code>tobit</code>, <code>quantile</code></p> <p>Working with survey data? - Full support: <code>ls</code>, <code>logit</code>, <code>probit</code>, <code>poisson</code>, <code>gamma</code> - Approximation: <code>negbin</code> (uses quasipoisson) - Not supported: <code>tobit</code>, <code>quantile</code></p>"},{"location":"vignettes/comparison/","title":"Comparison with the Original Zelig","text":""},{"location":"vignettes/comparison/#background","title":"Background","text":"<p><code>zelig2</code> is a reimplementation of the original Zelig R package developed at Harvard's Institute for Quantitative Social Science (King, Tomz, and Wittenberg 2000; Imai, King, and Lau 2007, 2008). The original Zelig introduced a unified framework for statistical estimation, counterfactual simulation, and presentation of results --- the <code>zelig() -&gt; setx() -&gt; sim() -&gt; plot()</code> workflow. <code>zelig2</code> preserves this workflow while modernizing the implementation.</p> <p>This page demonstrates two things:</p> <ol> <li>Identical results: <code>zelig2</code> produces the same coefficient estimates, simulated quantities of interest, and plots as the original Zelig.</li> <li>New extensions: <code>zelig2</code> adds capabilities that the original Zelig did not support --- fixed effects, seamless survey weights, and cluster-robust standard errors.</li> </ol> <p>All examples use data from the U.S. Census Bureau's Household Pulse Survey (Week 62, N = 58,202).</p>"},{"location":"vignettes/comparison/#part-a-identical-results","title":"Part A: Identical Results","text":""},{"location":"vignettes/comparison/#coefficients","title":"Coefficients","text":"<p>Both packages use <code>glm()</code> as the underlying estimation engine, so point estimates and standard errors match exactly:</p> Zeligzelig2 <pre><code>library(Zelig)\nz &lt;- zelig(mh_score ~ age + college + income_k,\n           model = \"ls\", data = pulse)\nsummary(z)\n</code></pre> <pre><code>Coefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)  7.4623284  0.0524801  142.19   &lt;2e-16\nage         -0.0576614  0.0008495  -67.87   &lt;2e-16\ncollege     -0.5399261  0.0291606  -18.52   &lt;2e-16\nincome_k    -0.0104966  0.0001997  -52.56   &lt;2e-16\n</code></pre> <pre><code>library(zelig2)\nz &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse, num = 1000L)\nsummary(z)\n</code></pre> <pre><code>Coefficients:\n               Estimate  Std. Error z value  Pr(&gt;|z|)\n(Intercept)  7.46232840  0.05248010 142.194 &lt; 2.2e-16 ***\nage         -0.05766141  0.00084954 -67.874 &lt; 2.2e-16 ***\ncollege     -0.53992615  0.02916059 -18.516 &lt; 2.2e-16 ***\nincome_k    -0.01049659  0.00019970 -52.562 &lt; 2.2e-16 ***\n</code></pre> Variable Zelig <code>zelig2</code> (Intercept) 7.46232840 7.46232840 age -0.05766141 -0.05766141 college -0.53992615 -0.53992615 income_k -0.01049659 -0.01049659 <p></p>"},{"location":"vignettes/comparison/#point-scenario-plots","title":"Point Scenario Plots","text":"<p>Both packages implement the King, Tomz, and Wittenberg (2000) simulation approach: draw \\(\\tilde{\\beta}\\) from \\(N(\\hat{\\beta}, \\hat{V})\\), then compute quantities of interest at specified covariate values. The plots below extract the raw simulation draws from each package and render them with identical formatting for direct comparison.</p> <p>Scenario: 40-year-old college graduate earning $75,000.</p> Zeligzelig2 <pre><code>z &lt;- setx(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nplot(z)\n</code></pre> <pre><code>z &lt;- setx(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nplot(z)\n</code></pre> <p></p> <p>The density shapes, centers, and spreads are the same in both panels. Both produce an expected value of 3.83 (95% CI: 3.78, 3.87). The minor variation in density shape reflects simulation randomness (different draws from the same distribution).</p>"},{"location":"vignettes/comparison/#first-difference-plots","title":"First Difference Plots","text":"<p>First differences --- the change in expected value when one covariate changes --- are the central quantity in the Zelig framework. Here we compare college graduates to non-graduates:</p> Zeligzelig2 <pre><code>z &lt;- setx(z, age = 40, college = 0, income_k = 75)\nz &lt;- setx1(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nplot(z)\n</code></pre> <pre><code>z &lt;- setx(z, age = 40, college = 0, income_k = 75)\nz &lt;- setx1(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nplot(z)\n</code></pre> <p></p> <p>The top row shows the two overlaid expected value distributions for each scenario (college in blue, no college in coral). The bottom row shows the first difference density. Both packages estimate a first difference of -0.54 (95% CI: -0.60, -0.48) --- a college degree is associated with a 0.54-point reduction in mental health symptom scores.</p>"},{"location":"vignettes/comparison/#range-scenario-plot","title":"Range Scenario Plot","text":"<p><code>zelig2</code> adds a range workflow for visualizing how expected values change across a continuous predictor:</p> <pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse, num = 1000L)\nz &lt;- setx(z, age = 40, college = 1,\n          income_k = seq(25, 250, by = 25))\nz &lt;- sim(z)\nplot(z)\n</code></pre> <p></p> <p>Expected symptom scores decline from 4.35 to 1.99 as household income increases from $25,000 to $250,000. The ribbon represents the 95% confidence band from 1,000 simulated draws.</p>"},{"location":"vignettes/comparison/#part-b-extensions-beyond-the-original-zelig","title":"Part B: Extensions Beyond the Original Zelig","text":""},{"location":"vignettes/comparison/#1-fixed-effects","title":"1. Fixed Effects","text":"<p>The original Zelig did not support fixed effects. <code>zelig2</code> integrates the <code>fixest</code> package (Berge 2018), allowing fixed effects via <code>|</code> in the formula:</p> <pre><code>z_fe &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n               model = \"ls\", data = pulse, num = 1000L)\nsummary(z_fe)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nFull formula:  mh_score ~ age + college + income_k | state_fct\nN:  58202\nFixed effects:  state_fct\n\nCoefficients:\n            Estimate  Std. Error z value  Pr(&gt;|z|)\nage      -0.05798140  0.00085191 -68.061 &lt; 2.2e-16 ***\ncollege  -0.53324388  0.02922396 -18.247 &lt; 2.2e-16 ***\nincome_k -0.01054457  0.00020256 -52.056 &lt; 2.2e-16 ***\n</code></pre> <p>The 51 state fixed effects absorb all time-invariant state-level confounders. The <code>setx() -&gt; sim() -&gt; plot()</code> workflow works identically:</p> <pre><code>z_fe &lt;- setx(z_fe, age = 40, college = 1,\n             income_k = seq(25, 250, by = 25))\nz_fe &lt;- sim(z_fe)\nplot(z_fe)\n</code></pre> <p></p> <p>The wider confidence band (compared to Part A) reflects the additional uncertainty from averaging over state-level intercepts.</p>"},{"location":"vignettes/comparison/#2-survey-weights","title":"2. Survey Weights","text":"<p>The original Zelig required separate model types for survey-weighted estimation (e.g., <code>model = \"ls.survey\"</code> instead of <code>model = \"ls\"</code>). In <code>zelig2</code>, pass the weight vector directly --- no model type change needed:</p> <pre><code>z_svy &lt;- zelig2(mh_score ~ age + college + income_k,\n                model = \"ls\", data = pulse,\n                weights = pulse$pweight, num = 1000L)\n</code></pre> <pre><code>Coefficients:\n               Estimate  Std. Error  z value  Pr(&gt;|z|)\n(Intercept)  7.08844445  0.12424980  57.0499 &lt; 2.2e-16 ***\nage         -0.05369919  0.00194374 -27.6267 &lt; 2.2e-16 ***\ncollege     -0.40248340  0.05548744  -7.2536 4.059e-13 ***\nincome_k    -0.01016999  0.00038834 -26.1883 &lt; 2.2e-16 ***\n</code></pre> <p>Survey weighting substantially changes the estimates --- the college effect shrinks from -0.540 to -0.402 (a 26% reduction), and standard errors approximately double to reflect the survey design.</p> <pre><code>z_svy &lt;- setx(z_svy, age = 40, college = 1,\n              income_k = seq(25, 250, by = 25))\nz_svy &lt;- sim(z_svy)\nplot(z_svy)\n</code></pre> <p></p>"},{"location":"vignettes/comparison/#3-cluster-robust-standard-errors","title":"3. Cluster-Robust Standard Errors","text":"<p>The original Zelig did not support robust or clustered standard errors. <code>zelig2</code> provides HC0--HC4, cluster-robust, and bootstrap SEs via <code>vcov_type</code>:</p> <pre><code>z_cluster &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n                    model = \"ls\", data = pulse,\n                    vcov_type = \"cluster\", cluster = ~state_fct)\nsummary(z_cluster)\n</code></pre> <pre><code>Coefficients:\n            Estimate  Std. Error z value  Pr(&gt;|z|)\nage      -0.05798140  0.00118716 -48.840 &lt; 2.2e-16 ***\ncollege  -0.53324388  0.03369631 -15.825 &lt; 2.2e-16 ***\nincome_k -0.01054457  0.00026454 -39.861 &lt; 2.2e-16 ***\n</code></pre> <p>Clustering at the state level increases standard errors by 15--40%:</p> Variable Default SE Cluster SE Ratio age 0.00085 0.00119 1.40x college 0.02922 0.03370 1.15x income_k 0.00020 0.00026 1.31x"},{"location":"vignettes/comparison/#summary","title":"Summary","text":"Feature Original Zelig <code>zelig2</code> Point estimates Via <code>glm()</code> Via <code>glm()</code> (identical) <code>setx() -&gt; sim() -&gt; plot()</code> Yes Yes (same results) Fixed effects Not supported <code>y ~ x \\| fe</code> via <code>fixest</code> Survey weights Separate model types (<code>\"ls.survey\"</code>, <code>\"logit.survey\"</code>) <code>weights = ...</code> on any model Robust / clustered SEs Not supported <code>vcov_type = \"HC1\"</code>, <code>\"cluster\"</code>, <code>\"bootstrap\"</code> Plotting Base R <code>ggplot2</code> + <code>patchwork</code> Dependencies 16 packages 7 packages Last updated 2020 (incompatible with modern R) Active development"},{"location":"vignettes/comparison/#references","title":"References","text":"<ul> <li>King, G., Tomz, M., and Wittenberg, J. (2000). \"Making the Most of Statistical Analyses: Improving Interpretation and Presentation.\" American Journal of Political Science, 44(2), 347--361.</li> <li>Imai, K., King, G., and Lau, O. (2007). \"Zelig: Everyone's Statistical Software.\" R package.</li> <li>Imai, K., King, G., and Lau, O. (2008). \"Toward a Common Framework for Statistical Analysis and Development.\" Journal of Computational and Graphical Statistics, 17(4), 892--913.</li> <li>Berge, L. (2018). \"Efficient Estimation of Maximum Likelihood Models with Multiple Fixed-Effects: the R Package fixest.\" CREA Discussion Paper.</li> </ul>"},{"location":"vignettes/fixed-effects/","title":"Fixed Effects","text":""},{"location":"vignettes/fixed-effects/#introduction","title":"Introduction","text":"<p>Fixed effects models control for unobserved heterogeneity across groups (e.g., states, individuals, or time periods), allowing researchers to isolate within-group variation. The original Zelig package (Imai, King, and Lau 2007, 2008) did not support fixed effects. <code>zelig2</code> adds this capability through the <code>fixest</code> package (Berg\u00e9 2018), combining computational efficiency with the simulation-based inference approach of King, Tomz, and Wittenberg (2000).</p> <p>This vignette demonstrates fixed effects modeling using data from the U.S. Census Bureau's Household Pulse Survey (Week 62, N = 58,202), examining mental health outcomes across 51 states and territories.</p>"},{"location":"vignettes/fixed-effects/#specifying-fixed-effects","title":"Specifying Fixed Effects","text":""},{"location":"vignettes/fixed-effects/#pipe-syntax-recommended","title":"Pipe Syntax (Recommended)","text":"<p>Use <code>|</code> to separate predictors from fixed effects:</p> <pre><code>library(zelig2)\n\n# State fixed effects via pipe syntax\nz &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n            model = \"ls\", data = pulse)\n</code></pre> <p>The left side of <code>|</code> contains the outcome and covariates; the right side lists the fixed effect variables. Multiple fixed effects are supported: <code>y ~ x1 + x2 | fe1 + fe2</code>.</p>"},{"location":"vignettes/fixed-effects/#fixef-argument","title":"fixef Argument","text":"<p>Alternatively, use the <code>fixef</code> argument with a one-sided formula or character vector:</p> <pre><code># One-sided formula\nz &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse,\n            fixef = ~state_fct)\n\n# Character vector\nz &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse,\n            fixef = \"state_fct\")\n</code></pre> <p>Both approaches produce identical results.</p>"},{"location":"vignettes/fixed-effects/#model-estimation","title":"Model Estimation","text":"<pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n            model = \"ls\", data = pulse, num = 1000L)\n\nsummary(z)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nFull formula:  mh_score ~ age + college + income_k | state_fct\nN:  58202\nFixed effects:  state_fct\n\nCoefficients:\n            Estimate  Std. Error z value  Pr(&gt;|z|)\nage      -0.05798140  0.00085191 -68.061 &lt; 2.2e-16 ***\ncollege  -0.53324388  0.02922396 -18.247 &lt; 2.2e-16 ***\nincome_k -0.01054457  0.00020256 -52.056 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>Absorbed Intercept</p> <p>No intercept appears in the coefficient table. Each state has its own implicit intercept, which absorbs the overall constant.</p>"},{"location":"vignettes/fixed-effects/#interpreting-results","title":"Interpreting Results","text":"<p>The coefficients represent within-state associations:</p> <ul> <li>Age (-0.058): Each additional year of age is associated with a 0.058-point decrease in mental health symptom scores, within the same state.</li> <li>College (-0.533): A college degree is associated with 0.533 fewer symptom points, comparing individuals in the same state with the same age and income.</li> <li>Income (-0.011): Each additional $1,000 in income is associated with a 0.011-point reduction.</li> </ul> <p>The state fixed effects control for all time-invariant state-level characteristics (regional culture, policies, healthcare infrastructure) that might confound these relationships.</p>"},{"location":"vignettes/fixed-effects/#setting-scenarios-with-fixed-effects","title":"Setting Scenarios with Fixed Effects","text":""},{"location":"vignettes/fixed-effects/#specific-state","title":"Specific State","text":"<p>To predict outcomes for a specific state, pass the state level to <code>setx()</code>. Here we predict for California (FIPS code 6):</p> <pre><code>z &lt;- setx(z, age = 40, college = 1, income_k = 75, state_fct = \"6\")\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 4.0908  SD: 0.0442  [4.0014, 4.1785]\n</code></pre>"},{"location":"vignettes/fixed-effects/#averaging-over-states","title":"Averaging Over States","text":"<p>Omitting the fixed effect variable averages predictions across all state levels:</p> <pre><code>z &lt;- setx(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 3.8190  SD: 0.0457  [3.7309, 3.9043]\n</code></pre> <p>The California-specific prediction (4.09) is higher than the population average (3.82), indicating that California has a higher baseline level of mental health symptoms relative to the average state.</p> <p>Choosing Specific vs. Averaged Fixed Effects</p> <p>Use specific levels when making predictions for a particular group (e.g., California residents). Use averaged levels for general population-level predictions or when the specific group is not theoretically meaningful.</p>"},{"location":"vignettes/fixed-effects/#first-differences-with-fixed-effects","title":"First Differences with Fixed Effects","text":"<p>Compare college graduates to non-graduates, averaging over states:</p> <pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n            model = \"ls\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 40, college = 0, income_k = 75)\nz &lt;- setx1(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 4.3484  SD: 0.0391  [4.2694, 4.4232]\nFirst Differences:\n  Mean: -0.5316  SD: 0.0293  [-0.5895, -0.4714]\n</code></pre> <p>A college degree is associated with a 0.53-point reduction in mental health symptom scores (95% CI: -0.59, -0.47), after controlling for state-level unobserved heterogeneity.</p>"},{"location":"vignettes/fixed-effects/#cluster-robust-standard-errors","title":"Cluster-Robust Standard Errors","text":"<p>With state fixed effects, standard errors should be clustered at the state level to account for within-state error correlation:</p> <pre><code>z_cluster &lt;- zelig2(mh_score ~ age + college + income_k | state_fct,\n                    model = \"ls\", data = pulse,\n                    vcov_type = \"cluster\", cluster = ~state_fct)\n\nsummary(z_cluster)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nFull formula:  mh_score ~ age + college + income_k | state_fct\nN:  58202\nFixed effects:  state_fct\nVcov type:  cluster\n\nCoefficients:\n            Estimate  Std. Error z value  Pr(&gt;|z|)\nage      -0.05798140  0.00118716 -48.840 &lt; 2.2e-16 ***\ncollege  -0.53324388  0.03369631 -15.825 &lt; 2.2e-16 ***\nincome_k -0.01054457  0.00026454 -39.861 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>Standard Errors Increase with Clustering</p> Variable Default SE Cluster SE Ratio age 0.00085 0.00119 1.40x college 0.02922 0.03370 1.15x income_k 0.00020 0.00026 1.31x <p>Cluster-robust SEs are 15--40% larger because they account for within-state correlation. Failing to cluster can lead to overstated statistical significance.</p>"},{"location":"vignettes/fixed-effects/#supported-models","title":"Supported Models","text":"<p>Fixed effects via <code>fixest</code> are supported for:</p> Model <code>model =</code> fixest function Linear regression <code>\"ls\"</code> <code>fixest::feols()</code> Logistic regression <code>\"logit\"</code> <code>fixest::feglm()</code> Probit regression <code>\"probit\"</code> <code>fixest::feglm()</code> Poisson regression <code>\"poisson\"</code> <code>fixest::feglm()</code> Negative binomial <code>\"negbin\"</code> <code>fixest::fenegbin()</code> Gamma regression <code>\"gamma\"</code> <code>fixest::feglm()</code> <p>Models Without Fixed Effects Support</p> <p>Tobit and quantile regression do not support fixed effects. Attempting to use <code>|</code> or <code>fixef</code> with these models produces an informative error.</p>"},{"location":"vignettes/logistic-regression/","title":"Logistic Regression","text":"<p>Logistic regression models binary outcomes as a function of predictor variables. Unlike linear regression, logistic regression ensures predicted probabilities remain between 0 and 1 by modeling the log-odds of the outcome. In <code>zelig2</code>, logistic regression is specified with <code>model = \"logit\"</code> (following the original Zelig naming convention from Imai, King, and Lau 2007, 2008).</p>"},{"location":"vignettes/logistic-regression/#data-food-insecurity-in-america","title":"Data: Food Insecurity in America","text":"<p>This vignette uses data from the U.S. Census Bureau's Household Pulse Survey (Week 62, N = 58,202). The outcome is food insecurity, defined as a binary indicator (1 = sometimes or often not enough food to eat, 0 = enough food). Predictors include:</p> <ul> <li>age: Respondent age in years</li> <li>college: Binary indicator for bachelor's degree (1 = yes, 0 = no)</li> <li>income_k: Household income in thousands of dollars</li> </ul>"},{"location":"vignettes/logistic-regression/#model-estimation","title":"Model Estimation","text":"<pre><code>library(zelig2)\n\nz &lt;- zelig2(food_insecure ~ age + college + income_k,\n            model = \"logit\",\n            data = pulse,\n            num = 1000L)\n\nsummary(z)\n</code></pre> <pre><code>zelig2:  Logistic Regression\nFormula:  food_insecure ~ age + college + income_k\nN:  58202\n\nCoefficients:\n               Estimate  Std. Error  z value  Pr(&gt;|z|)\n(Intercept)  0.52286307  0.05693662   9.1832 &lt; 2.2e-16 ***\nage         -0.02426752  0.00097111 -24.9894 &lt; 2.2e-16 ***\ncollege     -0.89757810  0.03818323 -23.5071 &lt; 2.2e-16 ***\nincome_k    -0.02082702  0.00047535 -43.8138 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>All three predictors are highly significant and negatively associated with food insecurity.</p>"},{"location":"vignettes/logistic-regression/#interpreting-coefficients","title":"Interpreting Coefficients","text":"<p>Coefficients are on the log-odds scale. Exponentiating gives odds ratios:</p> <ul> <li>College degree: exp(-0.898) = 0.41. A college degree is associated with 59% lower odds of food insecurity.</li> <li>Income: exp(-0.0208) = 0.979. Each additional $1,000 in income is associated with 2.1% lower odds.</li> <li>Age: exp(-0.0243) = 0.976. Each additional year of age is associated with 2.4% lower odds.</li> </ul> <p>Log-Odds vs. Probabilities</p> <p>Odds ratios describe multiplicative effects on odds, not probabilities. As King, Tomz, and Wittenberg (2000) emphasize, predicted probabilities and first differences (shown below) are far more interpretable for substantive conclusions.</p>"},{"location":"vignettes/logistic-regression/#predicted-probabilities","title":"Predicted Probabilities","text":"<p>Following the Zelig framework (King, Tomz, and Wittenberg 2000), <code>setx()</code> and <code>sim()</code> convert log-odds to the probability scale (0--1), making results directly interpretable:</p> <pre><code>z &lt;- setx(z, age = 35, college = 0, income_k = 50)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 0.2029  SD: 0.0040  [0.1952, 0.2107]\n</code></pre> <p>A 35-year-old without a college degree earning $50,000 has approximately a 20.3% probability of food insecurity (95% CI: 19.5%, 21.1%).</p>"},{"location":"vignettes/logistic-regression/#first-differences","title":"First Differences","text":"<p>First differences show how predicted probabilities change between two scenarios. Here we compare $50,000 vs. $100,000 in household income:</p> <pre><code>z &lt;- zelig2(food_insecure ~ age + college + income_k,\n            model = \"logit\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 35, college = 0, income_k = 50)\nz &lt;- setx1(z, age = 35, college = 0, income_k = 100)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 0.2028  SD: 0.0038  [0.1955, 0.2104]\nFirst Differences:\n  Mean: -0.1204  SD: 0.0026  [-0.1254, -0.1154]\n</code></pre> <p>Increasing household income from $50,000 to $100,000 reduces the probability of food insecurity by approximately 12 percentage points (from 20.3% to 8.2%).</p> <p>Interpreting First Differences</p> <p>First differences are expressed as changes in probability (on a 0--1 scale). A first difference of -0.12 means a 12 percentage point decrease, not a 12% relative decrease.</p>"},{"location":"vignettes/logistic-regression/#range-scenarios","title":"Range Scenarios","text":"<p>To see how predicted probabilities change across the full income distribution, pass a vector of values:</p> <pre><code>z &lt;- zelig2(food_insecure ~ age + college + income_k,\n            model = \"logit\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 35, college = 0,\n          income_k = seq(25, 250, by = 25))\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values (range):\n      mean     sd 2.5%.2.5% 97.5%.97.5%\n25  0.3001 0.0051    0.2901      0.3095\n50  0.2029 0.0038    0.1954      0.2103\n75  0.1313 0.0032    0.1254      0.1376\n100 0.0824 0.0027    0.0774      0.0878\n125 0.0507 0.0022    0.0465      0.0552\n150 0.0307 0.0016    0.0276      0.0342\n175 0.0185 0.0012    0.0163      0.0210\n200 0.0111 0.0008    0.0095      0.0128\n225 0.0066 0.0006    0.0056      0.0078\n250 0.0039 0.0004    0.0032      0.0048\n</code></pre> <p>The range scenario reveals the characteristic nonlinearity of logistic regression:</p> <ol> <li>Largest effects at low incomes: Moving from $25k to $50k reduces probability by 10 percentage points (30.0% to 20.3%), while moving from $225k to $250k reduces it by only 0.3 percentage points.</li> <li>Diminishing returns: Additional income produces smaller reductions in food insecurity risk as income grows.</li> <li>Full range: For a 35-year-old without a college degree, food insecurity probability ranges from 30% at $25k to under 0.4% at $250k.</li> </ol> <pre><code>plot(z)\n</code></pre> <p></p> <p>Extrapolation</p> <p>Ensure covariate values fall within the observed data range. Predictions far outside the data may be unreliable.</p>"},{"location":"vignettes/ols/","title":"OLS Regression","text":""},{"location":"vignettes/ols/#overview","title":"Overview","text":"<p>Ordinary Least Squares (OLS) regression models the relationship between a continuous outcome and one or more predictors. In <code>zelig2</code>, OLS is specified with <code>model = \"ls\"</code> (following the original Zelig convention from Imai, King, and Lau 2007, 2008). After estimation, simulation-based inference via <code>setx()</code> and <code>sim()</code> --- implementing the approach of King, Tomz, and Wittenberg (2000, AJPS) --- translates coefficient estimates into substantively meaningful quantities: expected values, predicted values, and first differences with full uncertainty quantification.</p>"},{"location":"vignettes/ols/#data","title":"Data","text":"<p>This vignette uses data from the U.S. Census Bureau's Household Pulse Survey (Week 62), a nationally representative survey tracking social and economic impacts on American households during and after the COVID-19 pandemic. After cleaning, the dataset contains N = 58,202 respondents.</p> <p>The outcome variable is a mental health symptom score constructed from PHQ-4 items, ranging from 0 (no symptoms) to 12 (severe symptoms). Higher scores indicate worse mental health. Predictors include:</p> <ul> <li>age: Respondent age in years (18--88)</li> <li>college: Binary indicator (1 = bachelor's degree or higher)</li> <li>income_k: Annual household income in thousands of dollars (midpoints of bracket categories)</li> </ul>"},{"location":"vignettes/ols/#model-estimation","title":"Model Estimation","text":"<pre><code>library(zelig2)\n\nz &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\",\n            data = pulse,\n            num = 1000L)\n</code></pre>"},{"location":"vignettes/ols/#interpreting-the-results","title":"Interpreting the Results","text":"<pre><code>summary(z)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nN:  58202\n\nCoefficients:\n               Estimate  Std. Error z value  Pr(&gt;|z|)\n(Intercept)  7.46232840  0.05248010 142.194 &lt; 2.2e-16 ***\nage         -0.05766141  0.00084954 -67.874 &lt; 2.2e-16 ***\ncollege     -0.53992615  0.02916059 -18.516 &lt; 2.2e-16 ***\nincome_k    -0.01049659  0.00019970 -52.562 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>All three predictors are statistically significant:</p> <ul> <li>Age: Each additional year of age is associated with a 0.058-point decrease in mental health symptom scores. Older adults report fewer symptoms on average.</li> <li>College education: Having a bachelor's degree is associated with a 0.540-point reduction in symptom scores, holding age and income constant.</li> <li>Income: Each additional $1,000 in household income is associated with a 0.010-point decrease in symptom scores.</li> </ul>"},{"location":"vignettes/ols/#setting-scenarios-and-simulating","title":"Setting Scenarios and Simulating","text":""},{"location":"vignettes/ols/#point-scenario","title":"Point Scenario","text":"<p>What is the expected mental health score for a 40-year-old college graduate earning $75,000?</p> <pre><code>z &lt;- setx(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 3.8283  SD: 0.0229  [3.7833, 3.8726]\n</code></pre> <p>The expected symptom score is 3.83 (95% CI: 3.78, 3.87) --- a moderate-low level of symptoms. The narrow confidence interval reflects the large sample size.</p>"},{"location":"vignettes/ols/#first-differences","title":"First Differences","text":"<p>First differences --- a central quantity of interest in the Zelig framework (King, Tomz, and Wittenberg 2000) --- quantify the expected change in the outcome when one covariate changes while others are held constant. Here we compare college graduates to non-graduates:</p> <pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 40, college = 0, income_k = 75)\nz &lt;- setx1(z, age = 40, college = 1, income_k = 75)\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 4.3690  SD: 0.0237  [4.3236, 4.4131]\nFirst Differences:\n  Mean: -0.5399  SD: 0.0285  [-0.5952, -0.4857]\n</code></pre> <p>For 40-year-olds earning $75,000:</p> <ul> <li>Without a college degree: Expected score of 4.37 (95% CI: 4.32, 4.41)</li> <li>With a college degree: Expected score of 3.83 (95% CI: 3.78, 3.87)</li> <li>First difference: -0.54 (95% CI: -0.60, -0.49)</li> </ul> <p>Having a college degree is associated with a 0.54-point reduction in mental health symptom scores, approximately a 12% reduction relative to the non-college baseline.</p>"},{"location":"vignettes/ols/#range-scenarios","title":"Range Scenarios","text":"<p>To see how expected values change across a continuous predictor, pass a vector of values to <code>setx()</code>:</p> <pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse, num = 1000L)\n\nz &lt;- setx(z, age = 40, college = 1,\n          income_k = seq(25, 250, by = 25))\nz &lt;- sim(z)\nsummary(z)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values (range):\n      mean     sd 2.5%.2.5% 97.5%.97.5%\n25  4.3526 0.0295    4.2942      4.4083\n50  4.0903 0.0262    4.0393      4.1396\n75  3.8279 0.0234    3.7825      3.8746\n100 3.5655 0.0215    3.5232      3.6069\n125 3.3032 0.0207    3.2629      3.3426\n150 3.0408 0.0210    2.9986      3.0820\n175 2.7784 0.0225    2.7332      2.8224\n200 2.5161 0.0249    2.4672      2.5649\n225 2.2537 0.0280    2.1966      2.3092\n250 1.9913 0.0315    1.9277      2.0519\n</code></pre> <p>As household income increases from $25,000 to $250,000, expected symptom scores decline from 4.35 to 1.99 --- a reduction of 2.36 points (54%). Plotting these results produces a ribbon plot showing the confidence band:</p> <pre><code>plot(z)\n</code></pre> <p></p>"},{"location":"vignettes/ols/#robust-standard-errors","title":"Robust Standard Errors","text":"<p>When heteroskedasticity is a concern, use <code>vcov_type</code> to specify robust standard errors:</p> <pre><code>z_robust &lt;- zelig2(mh_score ~ age + college + income_k,\n                   model = \"ls\", data = pulse,\n                   vcov_type = \"HC1\")\nsummary(z_robust)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nN:  58202\nVcov type:  HC1\n\nCoefficients:\n               Estimate  Std. Error z value  Pr(&gt;|z|)\n(Intercept)  7.46232840  0.05623047 132.710 &lt; 2.2e-16 ***\nage         -0.05766141  0.00084374 -68.340 &lt; 2.2e-16 ***\ncollege     -0.53992615  0.02966020 -18.204 &lt; 2.2e-16 ***\nincome_k    -0.01049659  0.00018864 -55.642 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>Comparing standard and robust SEs:</p> Variable Standard SE Robust SE (HC1) Change (Intercept) 0.05248 0.05623 +7.1% age 0.00085 0.00084 -0.7% college 0.02916 0.02966 +1.7% income_k 0.00020 0.00019 -5.5% <p>The differences are modest, suggesting limited heteroskedasticity. Available options include <code>\"HC0\"</code> through <code>\"HC4\"</code>, <code>\"cluster\"</code>, and <code>\"bootstrap\"</code>.</p> <p>When to Use Robust Standard Errors</p> <p>Robust SEs are recommended when working with cross-sectional survey data, when diagnostic plots suggest non-constant variance, or when you want inference that does not rely on the homoskedasticity assumption. They are widely accepted in applied research and generally conservative.</p>"},{"location":"vignettes/survey-logistic/","title":"Survey-Weighted Logistic Regression","text":""},{"location":"vignettes/survey-logistic/#introduction","title":"Introduction","text":"<p>For binary outcomes, ignoring survey weights can produce biased coefficient estimates and severely underestimated standard errors. In the original Zelig package (Imai, King, and Lau 2007, 2008), survey-weighted logistic regression required specifying <code>model = \"logit.survey\"</code> as a separate model type. <code>zelig2</code> simplifies this: pass the weight vector to <code>weights</code> and the model is automatically estimated via <code>survey::svyglm</code> (Lumley 2004) with <code>family = binomial(link = \"logit\")</code>.</p> <p>This vignette uses data from the U.S. Census Bureau's Household Pulse Survey (Week 62, N = 58,202) to examine predictors of food insecurity.</p>"},{"location":"vignettes/survey-logistic/#data","title":"Data","text":"<ul> <li>Outcome: <code>food_insecure</code> (binary) --- household experienced food insufficiency in the past 7 days</li> <li>Predictors: <code>age</code> (years), <code>college</code> (bachelor's or higher, binary), <code>income_k</code> (household income in $1000s)</li> <li>Survey weight: <code>pweight</code> --- person-level probability weight</li> </ul> <p>The Household Pulse Survey uses stratification by state and unequal selection probabilities. Probability weights ensure estimates reflect the U.S. household population.</p>"},{"location":"vignettes/survey-logistic/#model-estimation","title":"Model Estimation","text":"<pre><code>library(zelig2)\n\nz_weighted &lt;- zelig2(\n  food_insecure ~ age + college + income_k,\n  model = \"logit\",\n  data = pulse,\n  weights = pulse$pweight,\n  num = 1000L\n)\n\nsummary(z_weighted)\n</code></pre> <pre><code>zelig2:  Logistic Regression\nFormula:  food_insecure ~ age + college + income_k\nN:  58202\nSurvey-weighted: yes\n\nCoefficients:\n               Estimate  Std. Error  z value Pr(&gt;|z|)\n(Intercept)  0.20445025  0.09842872   2.0771  0.03779 *\nage         -0.01950071  0.00158885 -12.2735  &lt; 2e-16 ***\ncollege     -0.83557721  0.07313967 -11.4244  &lt; 2e-16 ***\nincome_k    -0.01761030  0.00092506 -19.0369  &lt; 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>Survey-Weighted Standard Errors</p> <p>Weighted standard errors account for the survey design and are typically larger than naive unweighted SEs.</p>"},{"location":"vignettes/survey-logistic/#comparing-weighted-vs-unweighted-estimates","title":"Comparing Weighted vs. Unweighted Estimates","text":"<pre><code>z_unweighted &lt;- zelig2(food_insecure ~ age + college + income_k,\n                       model = \"logit\", data = pulse)\n\ncoef(z_unweighted)\n</code></pre> <pre><code>(Intercept)         age     college    income_k\n 0.52286307 -0.02426752 -0.89757810 -0.02082702\n</code></pre> <pre><code>coef(z_weighted)\n</code></pre> <pre><code>(Intercept)         age     college    income_k\n 0.20445025 -0.01950071 -0.83557721 -0.01761030\n</code></pre> <p>Substantial Differences</p> <p>The weighted intercept (0.204) is much smaller than the unweighted estimate (0.523), suggesting that the unweighted sample overstates baseline food insecurity risk. The age and income coefficients are attenuated with weights. The college effect is similar (-0.836 vs. -0.898).</p> <p>Standard errors are approximately 2x larger: college SE is 0.073 (weighted) vs. 0.038 (unweighted). Ignoring survey design leads to false precision.</p>"},{"location":"vignettes/survey-logistic/#predicted-probabilities","title":"Predicted Probabilities","text":"<pre><code>z_weighted &lt;- setx(z_weighted, age = 35, college = 0, income_k = 50)\nz_weighted &lt;- sim(z_weighted)\nsummary(z_weighted)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 0.2044  SD: 0.0068  [0.1914, 0.2171]\n</code></pre> <p>A 35-year-old without a college degree earning $50,000 has a 20.4% probability of food insecurity (95% CI: 19.1%, 21.7%).</p>"},{"location":"vignettes/survey-logistic/#first-differences","title":"First Differences","text":"<p>How much does doubling income from $50,000 to $100,000 reduce food insecurity risk?</p> <pre><code>z_weighted &lt;- zelig2(food_insecure ~ age + college + income_k,\n                     model = \"logit\", data = pulse,\n                     weights = pulse$pweight, num = 1000L)\n\nz_weighted &lt;- setx(z_weighted, age = 35, college = 0, income_k = 50)\nz_weighted &lt;- setx1(z_weighted, age = 35, college = 0, income_k = 100)\nz_weighted &lt;- sim(z_weighted)\nsummary(z_weighted)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 0.2045  SD: 0.0071  [0.1908, 0.2188]\nFirst Differences:\n  Mean: -0.1081  SD: 0.0048  [-0.1177, -0.0987]\n</code></pre> <p>Moving from $50,000 to $100,000 in income reduces food insecurity probability by 10.8 percentage points (95% CI: -11.8, -9.9). The unweighted model estimates 12.0 pp, overstating the effect by about 11%.</p>"},{"location":"vignettes/survey-logistic/#range-scenarios","title":"Range Scenarios","text":"<p>Simulate across the full income distribution:</p> <pre><code>z_weighted &lt;- zelig2(food_insecure ~ age + college + income_k,\n                     model = \"logit\", data = pulse,\n                     weights = pulse$pweight, num = 1000L)\n\nz_weighted &lt;- setx(z_weighted, age = 35, college = 0,\n                   income_k = seq(25, 250, by = 25))\nz_weighted &lt;- sim(z_weighted)\nsummary(z_weighted)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values (range):\n      mean     sd 2.5%.2.5% 97.5%.97.5%\n25  0.2858 0.0089    0.2683      0.3031\n50  0.2047 0.0068    0.1918      0.2181\n75  0.1421 0.0062    0.1303      0.1545\n100 0.0963 0.0058    0.0850      0.1082\n125 0.0642 0.0052    0.0545      0.0748\n150 0.0424 0.0043    0.0344      0.0510\n175 0.0277 0.0035    0.0216      0.0349\n200 0.0181 0.0027    0.0134      0.0238\n225 0.0117 0.0020    0.0083      0.0161\n250 0.0076 0.0015    0.0051      0.0108\n</code></pre> <p>The income gradient is steep at lower incomes:</p> <ul> <li>At $25,000: 28.6% probability of food insecurity</li> <li>At $100,000: 9.6% (19 pp reduction from $25k)</li> <li>At $250,000: 0.8% (near zero risk)</li> </ul> <p>The steepest marginal reductions occur between $25k and $100k. Above $100k, the marginal effect diminishes as baseline risk becomes very low.</p> <pre><code>plot(z_weighted)\n</code></pre> <p></p>"},{"location":"vignettes/survey-logistic/#summary","title":"Summary","text":"<p>Following the Zelig framework (Imai, King, and Lau 2007, 2008), <code>zelig2</code> makes survey-weighted logistic regression accessible through the same <code>zelig2() -&gt; setx() -&gt; sim()</code> pipeline used for unweighted models. Key takeaways:</p> <ol> <li>Simple syntax: <code>weights = your_weight_vector</code> --- no separate model type needed.</li> <li>Coefficients change: Survey weights can substantially affect estimates. The unweighted intercept overstates baseline risk.</li> <li>Larger standard errors: Weighted SEs are typically 1.5--3x larger, reflecting design effects.</li> <li>Probability-scale inference: <code>setx()</code> and <code>sim()</code> produce predicted probabilities, which are far more interpretable than log-odds.</li> <li>First differences: Quantify effects as changes in probability at specific covariate profiles.</li> <li>Range scenarios: Reveal the nonlinear income--food insecurity gradient, steepest at low incomes.</li> </ol>"},{"location":"vignettes/survey-ols/","title":"Survey-Weighted OLS","text":""},{"location":"vignettes/survey-ols/#overview","title":"Overview","text":"<p>Survey weights correct for differential selection probabilities and nonresponse in complex survey data. Ignoring weights can produce biased coefficient estimates and underestimated standard errors.</p> <p>The original Zelig package (Imai, King, and Lau 2007, 2008) required separate model types for survey-weighted estimation (e.g., <code>\"ls.survey\"</code> instead of <code>\"ls\"</code>). <code>zelig2</code> simplifies this: pass a numeric weight vector to <code>weights</code> and the model is automatically estimated via <code>survey::svyglm</code> (Lumley 2004). No separate model type is needed.</p> <p>This vignette uses data from the U.S. Census Bureau's Household Pulse Survey (Week 62, N = 58,202), a nationally representative survey with person-level probability weights (<code>PWEIGHT</code>).</p>"},{"location":"vignettes/survey-ols/#model-estimation-with-survey-weights","title":"Model Estimation with Survey Weights","text":"<pre><code>library(zelig2)\n\nz_weighted &lt;- zelig2(\n  mh_score ~ age + college + income_k,\n  model = \"ls\",\n  data = pulse,\n  weights = pulse$pweight,\n  num = 1000L\n)\n\nsummary(z_weighted)\n</code></pre> <pre><code>zelig2:  Least Squares (Linear Regression)\nFormula:  mh_score ~ age + college + income_k\nN:  58202\nSurvey-weighted: yes\n\nCoefficients:\n               Estimate  Std. Error  z value  Pr(&gt;|z|)\n(Intercept)  7.08844445  0.12424980  57.0499 &lt; 2.2e-16 ***\nage         -0.05369919  0.00194374 -27.6267 &lt; 2.2e-16 ***\ncollege     -0.40248340  0.05548744  -7.2536 4.059e-13 ***\nincome_k    -0.01016999  0.00038834 -26.1883 &lt; 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n</code></pre> <p>Standard errors reflect the survey design and are generally larger than unweighted estimates.</p>"},{"location":"vignettes/survey-ols/#comparing-weighted-vs-unweighted-estimates","title":"Comparing Weighted vs. Unweighted Estimates","text":"<pre><code>z_unweighted &lt;- zelig2(mh_score ~ age + college + income_k,\n                       model = \"ls\", data = pulse)\n\ncoef(z_unweighted)\n</code></pre> <pre><code>(Intercept)         age     college    income_k\n 7.46232840 -0.05766141 -0.53992615 -0.01049659\n</code></pre> <pre><code>coef(z_weighted)\n</code></pre> <pre><code>(Intercept)         age     college    income_k\n 7.08844445 -0.05369919 -0.40248340 -0.01016999\n</code></pre> <p>Substantial Differences</p> <p>The college effect is -0.540 unweighted but -0.402 weighted --- a 34% difference. The unweighted sample overrepresents college-educated respondents, who differ systematically in mental health outcomes.</p> <p>Survey-weighted standard errors are also larger (college SE: 0.029 unweighted vs. 0.055 weighted). This reflects the effective sample size reduction from weighting and properly accounts for the survey design.</p>"},{"location":"vignettes/survey-ols/#simulating-quantities-of-interest","title":"Simulating Quantities of Interest","text":"<p>Set covariates and simulate expected values from the weighted model:</p> <pre><code>z_weighted &lt;- setx(z_weighted, age = 40, college = 1, income_k = 75)\nz_weighted &lt;- sim(z_weighted)\nsummary(z_weighted)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 3.7779  SD: 0.0451  [3.6871, 3.8663]\n</code></pre> <p>A 40-year-old college graduate earning $75,000 has an expected mental health score of 3.78 (95% CI: 3.69, 3.87). The wider confidence interval compared to the unweighted model (SD 0.045 vs. 0.023) reflects the additional uncertainty from survey weighting.</p>"},{"location":"vignettes/survey-ols/#first-differences","title":"First Differences","text":"<p>Compare college graduates to non-graduates under the weighted model:</p> <pre><code>z_weighted &lt;- zelig2(mh_score ~ age + college + income_k,\n                     model = \"ls\", data = pulse,\n                     weights = pulse$pweight, num = 1000L)\n\nz_weighted &lt;- setx(z_weighted, age = 40, college = 0, income_k = 75)\nz_weighted &lt;- setx1(z_weighted, age = 40, college = 1, income_k = 75)\nz_weighted &lt;- sim(z_weighted)\nsummary(z_weighted)\n</code></pre> <pre><code>--- Simulation Summary ( 1000  draws) ---\nExpected Values:\n  Mean: 4.1784  SD: 0.0499  [4.0852, 4.2774]\nFirst Differences:\n  Mean: -0.4016  SD: 0.0539  [-0.5137, -0.3021]\n</code></pre> <p>College graduates have mental health scores 0.40 points lower (better) than non-graduates (95% CI: -0.51, -0.30). Note that the weighted first difference (-0.40) is attenuated relative to the unweighted estimate (-0.54), reflecting the correction for sample composition.</p>"},{"location":"vignettes/survey-ols/#alternative-ways-to-specify-weights","title":"Alternative Ways to Specify Weights","text":""},{"location":"vignettes/survey-ols/#pre-built-survey-design","title":"Pre-built Survey Design","text":"<p>Pass an existing <code>survey::svydesign</code> object:</p> <pre><code>library(survey)\n\npulse_design &lt;- svydesign(ids = ~1, weights = ~pweight, data = pulse)\n\nz &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse,\n            survey_design = pulse_design)\n</code></pre>"},{"location":"vignettes/survey-ols/#complex-designs","title":"Complex Designs","text":"<p>For surveys with clustering, stratification, or finite population corrections:</p> <pre><code>z &lt;- zelig2(mh_score ~ age + college + income_k,\n            model = \"ls\", data = pulse,\n            weights = pulse$pweight,\n            ids = ~cluster_id,\n            strata = ~stratum)\n</code></pre> <p>These arguments are passed to <code>survey::svydesign</code> internally.</p> <p>When to Use Survey Weights</p> <p>Use weights whenever your data come from a complex survey design: national surveys (NHANES, CPS, ACS), multi-stage cluster samples, stratified samples, or surveys with oversampling or differential nonresponse.</p>"},{"location":"vignettes/survey-ols/#references","title":"References","text":"<ul> <li>King, G., Tomz, M., and Wittenberg, J. (2000). \"Making the Most of Statistical Analyses: Improving Interpretation and Presentation.\" American Journal of Political Science, 44(2), 347--361.</li> <li>Imai, K., King, G., and Lau, O. (2008). \"Toward a Common Framework for Statistical Analysis and Development.\" Journal of Computational and Graphical Statistics, 17(4), 892--913.</li> <li>Lumley, T. (2004). \"Analysis of Complex Survey Samples.\" Journal of Statistical Software, 9(8), 1--19.</li> </ul>"}]}